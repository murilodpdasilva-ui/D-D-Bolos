<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>D&D Bolos e Del√≠cias</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Poppins', sans-serif; background-color:#FFF8F0; text-align:center; color:#5D4037; padding:20px;}
    h1,h2 { color:#8D6E63; font-weight:600;}
    .produto { border:1px solid #ccc; padding:15px; margin:10px; border-radius:10px; display:inline-block; text-align:left; width:250px; vertical-align:top;}
    .produto button { margin-top:5px; padding:5px 10px; border:none; border-radius:5px; cursor:pointer; background-color:#F3E2B3;}
    .produto button:hover { background-color:#E6D1A3;}
    #carrinho { margin-top:20px; text-align:left; max-width:400px; margin-left:auto; margin-right:auto;}
    #carrinho button { width:100%; margin-top:10px; background-color:#F3E2B3; padding:10px; border-radius:8px;}
  </style>
</head>
<body>

  <h1>üç∞ D&D Bolos e Del√≠cias</h1>

  <h2>Card√°pio</h2>
  <div id="lista-produtos"></div>

  <h2>üõí Carrinho</h2>
  <div id="carrinho"></div>
  <button onclick="finalizarCompra()">Finalizar Pedido</button>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, collection, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCzbARMpHLybFuU-1xFqH0QIc-MuoeRIRE",
    authDomain: "dd-bolos.firebaseapp.com",
    projectId: "dd-bolos",
    storageBucket: "dd-bolos.firebasestorage.app",
    messagingSenderId: "887742402793",
    appId: "1:887742402793:web:e13d26f8e9ca28a94f2078"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const lista = document.getElementById("lista-produtos");
  const carrinhoDiv = document.getElementById("carrinho");

  let produtos = [];
  let carrinho = [];

  async function carregarProdutos() {
    const querySnapshot = await getDocs(collection(db, "produtos"));
    produtos = [];
    lista.innerHTML = "";

    querySnapshot.forEach((docSnap) => {
      const produto = docSnap.data();
      produto.id = docSnap.id;
      produtos.push(produto);

      lista.innerHTML += `
        <div class="produto">
          <h3>${produto.nome}</h3>
          <p>${produto.descricao || ""}</p>
          <p><strong>R$ ${Number(produto.preco).toFixed(2)}</strong></p>
          <p>Estoque: ${produto.quantidade}</p>
          <button onclick="adicionarCarrinho('${produto.id}')">Adicionar</button>
        </div>
      `;
    });
  }

  window.adicionarCarrinho = function(id) {
    const produto = produtos.find(p => p.id === id);

    if (!produto || produto.quantidade <= 0) {
      alert("Produto sem estoque!");
      return;
    }

    const item = carrinho.find(p => p.id === id);

    if (item) {
      if (item.quantidade < produto.quantidade) {
        item.quantidade++;
      } else {
        alert("Quantidade m√°xima atingida!");
        return;
      }
    } else {
      carrinho.push({ ...produto, quantidade: 1 });
    }

    atualizarCarrinho();
  };

  function atualizarCarrinho() {
    carrinhoDiv.innerHTML = "";
    carrinho.forEach(item => {
      carrinhoDiv.innerHTML += `<p>${item.nome} - ${item.quantidade}x</p>`;
    });
  }

  window.finalizarCompra = async function() {
    if (carrinho.length === 0) {
      alert("Carrinho vazio!");
      return;
    }

    let mensagem = "Ol√°! Gostaria de fazer um pedido:%0A%0A";

    for (const item of carrinho) {
      const produtoRef = doc(db, "produtos", item.id);
      const produtoOriginal = produtos.find(p => p.id === item.id);
      const novoEstoque = produtoOriginal.quantidade - item.quantidade;

      await updateDoc(produtoRef, { quantidade: novoEstoque });

      mensagem += `${item.nome} - ${item.quantidade}x%0A`;
    }

    mensagem += `%0ATotal: R$ ${carrinho.reduce((t,i)=>t+i.preco*i.quantidade,0).toFixed(2)}`;

    // Coloque seu n√∫mero no formato 5521XXXXXXXX
    window.open(`https://wa.me/5521976152436?text=${mensagem}`, "_blank");

    carrinho = [];
    atualizarCarrinho();
    carregarProdutos();
  };

  carregarProdutos();
</script>

</body>
</html>
